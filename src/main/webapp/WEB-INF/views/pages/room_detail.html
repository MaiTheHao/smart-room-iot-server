<!doctype html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{main_layout.html}">
	<head>
		<title th:text="${room.name} + ' | Dashboard'">Room Dashboard</title>
		<link rel="stylesheet" th:href="@{/webjars/bootstrap-daterangepicker/css/bootstrap-daterangepicker.css}" />
	</head>

	<body>
		<section class="content pt-3" layout:fragment="content">
			<div class="container-fluid">
				<div th:if="${errorMessage != null and !errorMessage.isEmpty()}" th:insert="~{fragments/common.html :: alert_error(${errorMessage})}"></div>

				<div class="card card-primary card-outline shadow-sm mb-4">
					<div class="card-body">
						<div class="row align-items-center">
							<div class="col-md-8 d-flex align-items-center">
								<div
									class="elevation-2 rounded-circle bg-primary d-flex justify-content-center align-items-center mr-3"
									style="width: 60px; height: 60px; font-size: 1.5rem"
								>
									<i class="fas fa-door-open"></i>
								</div>
								<div>
									<h3 class="text-bold text-dark mb-1" th:text="${pageTitle}">Room Name</h3>
									<div class="text-muted d-flex align-items-center">
										<i class="fas fa-map-marker-alt mr-1 text-sm"></i>
										<span th:text="${room?.description() ?: 'Smart Room Area'}">Description</span>

										<span class="mx-2">|</span>
										<span class="badge badge-success">Online</span>

										<span class="mx-2">|</span>
										<span id="healthScoreBadge" class="badge badge-secondary fade" style="opacity: 0">
											<i id="healthIcon" class="fas fa-heartbeat mr-1"></i>
											<span id="healthScoreValue">--%</span>
										</span>
									</div>
								</div>
							</div>
							<div class="col-md-4 text-md-right mt-3 mt-md-0">
								<a th:href="@{/home}" class="btn btn-default shadow-sm mr-2"> <i class="fas fa-arrow-left mr-1"></i> Dashboard </a>
								<button class="btn btn-primary shadow-sm"><i class="fas fa-cog mr-1"></i> Settings</button>
							</div>
						</div>
					</div>
					<input type="hidden" id="roomId" th:value="${room?.id()}" />
				</div>

				<div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
					<h5 class="m-0 text-dark"><i class="fas fa-chart-line mr-1"></i> Sensor Analytics</h5>
					<div class="form-inline mt-2 mt-md-0">
						<div class="input-group">
							<div class="input-group-prepend">
								<span class="input-group-text bg-white"><i class="far fa-calendar-alt"></i></span>
							</div>
							<input type="text" class="form-control float-right" id="date-range-picker" style="width: 34ch" />
							<div class="input-group-append">
								<button class="btn btn-default" id="btn-refresh-chart" title="Refresh Charts">
									<i class="fas fa-sync-alt"></i>
								</button>
								<button class="btn btn-info" id="btn-refresh-all" title="Refresh All Data"><i class="fas fa-redo"></i> Refresh All</button>
							</div>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-6 col-12" th:insert="~{fragments/room_detail/chart_cards.html :: temp_card(${currentTemp.orElse(null)})}"></div>
					<div class="col-lg-6 col-12" th:insert="~{fragments/room_detail/chart_cards.html :: power_card(${currentPower.orElse(null)})}"></div>
				</div>

				<div class="row mb-4">
					<div class="col-12">
						<div class="card card-outline card-success shadow-sm">
							<div class="card-header">
								<h3 class="card-title"><i class="fas fa-gamepad mr-1"></i> Quick Controls</h3>
							</div>
							<div class="card-body">
								<p class="text-muted small mb-2 text-uppercase font-weight-bold">Lights</p>
								<div id="lightsList">
									<div th:each="light : ${lights}" th:if="${light != null}">
										<div
											th:replace="~{fragments/room_detail/device_items.html :: light_switch(
                                        name=${light.name}, 
                                        description=${light.description}, 
                                        id=${light.id}, 
                                        isActive=${light.isActive}
                                    )}"
										></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<th:block layout:fragment="optional">
			<script defer th:src="@{/webjars/momentjs/min/moment.min.js}"></script>

			<script defer th:src="@{/webjars/bootstrap-daterangepicker/js/bootstrap-daterangepicker.js}"></script>

			<script defer th:src="@{/webjars/chartjs-adapter-moment/dist/chartjs-adapter-moment.min.js}"></script>
			<script defer th:src="@{/scripts/service/api/v1/room_api_v1.js}"></script>
			<script defer th:src="@{/scripts/service/api/v1/health_check_api_v1.js}"></script>
			<script defer th:src="@{/scripts/pages/room_detail.js}"></script>

			<script defer th:inline="javascript">
				$(function () {
					const roomId = $('#roomId').val();
					const tempData = /*[[${tempChartData}]]*/ [];
					const powerData = /*[[${powerChartData}]]*/ [];

					if (typeof RoomDetailPage !== 'undefined') {
						new RoomDetailPage(roomId, tempData, powerData);
					}
				});
			</script>
		</th:block>
	</body>
</html>
